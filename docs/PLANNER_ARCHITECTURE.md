# ğŸ“ˆ MÃ³dulo Planificador - Diagrama de Flujo

## Arquitectura General del MÃ³dulo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   APLICACIÃ“N SPM                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    FRONTEND (5173)                       â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  home.html                    planificador.html         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚  â”‚ MenÃº Lateral   â”‚          â”‚ Dashboard        â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   Link   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ Dashboard  â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â†’â”‚ â”‚ EstadÃ­sticas â”‚â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ Solicitudesâ”‚ â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ Crear      â”‚ â”‚          â”‚                â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ Notif.     â”‚ â”‚          â”‚ Tabla:        â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ Planificac.â”‚â—„â”¤  if Rol  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ (si rol OK)â”‚ â”‚          â”‚ â”‚ IDâ”‚Centro    â”‚â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ Preferenciasâ”‚ â”‚          â”‚ â”‚ Sectorâ”‚Critiâ”‚â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ Ayuda      â”‚ â”‚          â”‚ â”‚ Itemsâ”‚Monto â”‚â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                â”‚      â”‚ â”‚
â”‚  â”‚         â–²                    â”‚ Panel Detalles:â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚      â”‚ â”‚
â”‚  â”‚         â”‚ setupUserMenu()    â”‚ â”‚ Info General â”‚â”‚      â”‚ â”‚
â”‚  â”‚         â”‚ - Obtener rol      â”‚ â”‚ Materiales   â”‚â”‚      â”‚ â”‚
â”‚  â”‚         â”‚ - Mostrar section  â”‚ â”‚ AnÃ¡lisis     â”‚â”‚      â”‚ â”‚
â”‚  â”‚         â”‚   si rol OK        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                    â”‚                â”‚      â”‚ â”‚
â”‚  â”‚  planificador.js             â”‚ planificador.jsâ”‚      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â”‚  â”‚ checkAccess()          â”‚                           â”‚ â”‚
â”‚  â”‚  â”‚ â””â”€ Valida rol          â”‚                           â”‚ â”‚
â”‚  â”‚  â”‚ â””â”€ Si no OKâ†’redirect   â”‚                           â”‚ â”‚
â”‚  â”‚  â”‚                        â”‚                           â”‚ â”‚
â”‚  â”‚  â”‚ loadSolicitudes()      â”‚                           â”‚ â”‚
â”‚  â”‚  â”‚ â””â”€ GET /api/planner/   â”‚                           â”‚ â”‚
â”‚  â”‚  â”‚    solicitudes         â”‚                           â”‚ â”‚
â”‚  â”‚  â”‚                        â”‚                           â”‚ â”‚
â”‚  â”‚  â”‚ renderSolicitudes()    â”‚                           â”‚ â”‚
â”‚  â”‚  â”‚ â””â”€ Genera filas tabla  â”‚                           â”‚ â”‚
â”‚  â”‚  â”‚                        â”‚                           â”‚ â”‚
â”‚  â”‚  â”‚ showDetail(id)         â”‚                           â”‚ â”‚
â”‚  â”‚  â”‚ â””â”€ GET /api/planner/   â”‚                           â”‚ â”‚
â”‚  â”‚  â”‚    solicitudes/<id>    â”‚                           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  utils/api.js: window.AuthAPI                         â”‚ â”‚
â”‚  â”‚  - me()        â†’ obtener usuario actual               â”‚ â”‚
â”‚  â”‚  - logout()    â†’ cerrar sesiÃ³n                        â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â†• API Calls (JSON)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    BACKEND (5000)                       â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  app.py                                               â”‚ â”‚
â”‚  â”‚  â”œâ”€ Flask app factory                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ Blueprint registration:                           â”‚ â”‚
â”‚  â”‚  â”‚  - planner_bp (NEW!)                              â”‚ â”‚
â”‚  â”‚  â”‚  - auth_bp                                         â”‚ â”‚
â”‚  â”‚  â”‚  - solicitudes_bp                                  â”‚ â”‚
â”‚  â”‚  â”‚  - materiales_bp                                   â”‚ â”‚
â”‚  â”‚  â””â”€ etc.                                              â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  planner_routes.py (NEW!)                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚ â”‚
â”‚  â”‚  â”‚ @auth_required               â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚ @require_planner (custom)    â”‚                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚ â”‚
â”‚  â”‚  â”‚                              â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚ GET /api/planner/dashboard   â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚ â†’ count solicitudes por      â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚   estado                     â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚                              â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚ GET /api/planner/solicitudes â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚ â†’ query paginada a BD        â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚                              â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚ GET /api/planner/            â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚     solicitudes/<id>         â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚ â†’ detalles + materiales      â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚                              â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚ POST /api/planner/           â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚      solicitudes/<id>/       â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚      optimize                â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚ â†’ actualiza estado            â”‚                    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  auth_routes.py (Existing)                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ GET /api/auth/me                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ POST /api/auth/login                              â”‚ â”‚
â”‚  â”‚  â””â”€ POST /api/auth/logout                             â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  solicitudes.py (Existing)                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ GET /api/solicitudes                              â”‚ â”‚
â”‚  â”‚  â””â”€ POST /api/solicitudes                             â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â†• SQL Queries                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚            BASE DE DATOS (SQLite)                      â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  usuarios (existing)                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ id_spm (PK)                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ username                                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ rol â† VALIDADO AQUÃ                               â”‚ â”‚
â”‚  â”‚  â”œâ”€ nombre                                            â”‚ â”‚
â”‚  â”‚  â””â”€ ...                                               â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  solicitudes (existing)                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ id (PK)                                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ centro                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ sector                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ criticidad                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ estado                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ created_at                                        â”‚ â”‚
â”‚  â”‚  â””â”€ ...                                               â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  solicitudes_items (existing)                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ id (PK)                                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ solicitud_id (FK)                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ item_code                                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ cantidad                                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ precio_unitario                                   â”‚ â”‚
â”‚  â”‚  â””â”€ ...                                               â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de AutenticaciÃ³n y AutorizaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Usuario inicia sesiÃ³n en home.html  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. setupUserMenu() se ejecuta          â”‚
â”‚     - window.AuthAPI.me() obtiene user  â”‚
â”‚     - Recibe: {id, username, rol, ...}  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
          â†“                 â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Rol OK? â”‚       â”‚ Rol Bad? â”‚
     â”‚ Mostrar â”‚       â”‚ Ocultar  â”‚
     â”‚ link    â”‚       â”‚ secciÃ³n  â”‚
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Usuario hace clic en PlanificaciÃ³n  â”‚
â”‚     href="/planificador.html"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. planificador.html carga             â”‚
â”‚     - Ejecuta planificador.js           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. waitForAuthAPI()                    â”‚
â”‚     - Espera a window.AuthAPI (max 5s)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. checkAccess()                       â”‚
â”‚     - window.AuthAPI.me() nuevamente    â”‚
â”‚     - Valida: rol en rolesPermitidos?   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
          â†“                 â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Rol OK? â”‚       â”‚ Rol NO OK?   â”‚
     â”‚ Continuâ”‚       â”‚ - Toast errorâ”‚
     â”‚ con     â”‚       â”‚ - Redirect a â”‚
     â”‚ carga   â”‚       â”‚   /home.html â”‚
     â”‚ datos   â”‚       â”‚   (2 seg)    â”‚
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. loadSolicitudes()                   â”‚
â”‚     GET /api/planner/solicitudes        â”‚
â”‚     credentials: 'include'              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    BACKEND API       â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ @auth_required       â”‚
        â”‚ - Valida JWT/session â”‚
        â”‚ @require_planner     â”‚
        â”‚ - Valida rol         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
          â†“                 â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Auth OK?â”‚       â”‚ 401/403? â”‚
     â”‚ + Rol OKâ”‚       â”‚ Rechaza  â”‚
     â”‚ Query BDâ”‚       â”‚          â”‚
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SELECT solicitudes WHERE ...           â”‚
â”‚  LIMIT 10 OFFSET 0                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. renderSolicitudes()                 â”‚
â”‚     - Genera filas de tabla HTML        â”‚
â”‚     - Muestra estadÃ­sticas              â”‚
â”‚     - Muestra botones de acciones       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Usuario ve dashboard del            â”‚
â”‚     planificador con solicitudes        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de Carga de Detalles

```
Usuario hace clic en fila
        â†“
showDetail(solicitudId)
        â†“
GET /api/planner/solicitudes/{id}
        â†“
Backend:
- @auth_required (JWT/session)
- @require_planner (rol validation)
- Query: SELECT solicitudes WHERE id=?
- Query: SELECT solicitudes_items WHERE solicitud_id=?
        â†“
Response JSON con:
- Datos generales (centro, sector, etc)
- Array de materiales
- Total calculado
        â†“
Frontend:
- renderSolicitudDetail()
- populateDetailPanel()
- mostrar panel lateral
        â†“
Usuario puede:
- Ver detalles completos
- Ver materiales asociados
- Hacer clic en "Optimizar"
```

---

## Estructura de Directorios

```
src/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ db.py
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth_routes.py
â”‚   â”‚   â”œâ”€â”€ solicitudes.py
â”‚   â”‚   â”œâ”€â”€ materiales.py
â”‚   â”‚   â””â”€â”€ planner_routes.py âœ¨ NUEVO
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ auth/
â”‚           â””â”€â”€ auth.py
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ home.html ğŸ”„ MODIFICADO
â”‚   â”œâ”€â”€ mi-cuenta.html
â”‚   â”œâ”€â”€ crear-solicitud.html
â”‚   â”œâ”€â”€ planificador.html âœ¨ NUEVO
â”‚   â”œâ”€â”€ app.js
â”‚   â”œâ”€â”€ planificador.js âœ¨ NUEVO
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ api.js
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ unit/
    â”œâ”€â”€ integration/
    â””â”€â”€ test_planner_integration.py âœ¨ NUEVO
```

---

## Ciclo de Vida del MÃ³dulo Planificador

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. CARGA INICIAL (cuando se abre)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Verificar autenticaciÃ³n               â”‚
â”‚ - Cargar datos del usuario              â”‚
â”‚ - Obtener estadÃ­sticas                  â”‚
â”‚ - Cargar lista de solicitudes           â”‚
â”‚ - Renderizar UI                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. INTERACCIÃ“N DEL USUARIO               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Clic en fila â†’ showDetail()            â”‚
â”‚ - Clic en "Actualizar" â†’ loadSolicitudes()
â”‚ - Clic en "Siguiente" â†’ pÃ¡gina +1       â”‚
â”‚ - Clic en "Optimizar" â†’ POST /optimize  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. VALIDACIÃ“N Y AUTORIZACIÃ“N             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Cada acciÃ³n verifica:                 â”‚
â”‚   âœ“ Usuario autenticado?                â”‚
â”‚   âœ“ Rol correcto?                       â”‚
â”‚   âœ“ ParÃ¡metros vÃ¡lidos?                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. PROCESAMIENTO EN BACKEND              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Validar entrada                       â”‚
â”‚ - Consultar BD                          â”‚
â”‚ - Serializar respuesta                  â”‚
â”‚ - Enviar JSON                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. RENDERIZACIÃ“N EN FRONTEND             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Actualizar estado local               â”‚
â”‚ - Re-renderizar componentes             â”‚
â”‚ - Mostrar mensajes (toast)              â”‚
â”‚ - Actualizar UI                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. FEEDBACK AL USUARIO                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Toast: "âœ“ Ã‰xito" o "âœ— Error"         â”‚
â”‚ - Tabla actualizada                     â”‚
â”‚ - Panel cerrado o actualizado           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Matriz de Permisos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AcciÃ³n             â”‚ Usuario  â”‚ Planificador â”‚ Admin    â”‚
â”‚                    â”‚ Normal   â”‚              â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ver link menu      â”‚ âœ—        â”‚ âœ“            â”‚ âœ“        â”‚
â”‚ Abrir pÃ¡gina       â”‚ âœ—        â”‚ âœ“            â”‚ âœ“        â”‚
â”‚ Ver estadÃ­sticas   â”‚ âœ—        â”‚ âœ“            â”‚ âœ“        â”‚
â”‚ Listar solicitudes â”‚ âœ—        â”‚ âœ“            â”‚ âœ“        â”‚
â”‚ Ver detalles       â”‚ âœ—        â”‚ âœ“            â”‚ âœ“        â”‚
â”‚ Optimizar          â”‚ âœ—        â”‚ âœ“            â”‚ âœ“        â”‚
â”‚ Acceso a /api/...  â”‚ âœ—        â”‚ âœ“            â”‚ âœ“        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*Diagramas generados el 26 de octubre de 2025*
*MÃ³dulo Planificador v1.0.0*
